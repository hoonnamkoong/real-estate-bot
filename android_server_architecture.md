# 안드로이드 스마트폰 기반 자가 서버(Home Server) 아키텍처 설계서

이 문서는 Vercel 클라우드 환경에서 발생하는 'IP 전면 차단(네이버 부동산)'을 우회하고, 사용자가 소유한 안드로이드 공기계를 활용해 직접 서버 역할을 수행하게 만드는 2가지 하드웨어/소프트웨어 설계안입니다. 

안드로이드 폰은 **통신망(LTE/5G) 또는 일반 가정용 Wi-Fi 주소**를 할당받기 때문에, 네이버의 데이터센터 봇 차단 정책을 100% 회피할 수 있는 매우 훌륭한 크롤링 서버 플랫폼입니다.

---

## 🏗 아키텍처 옵션 1: 올인원 안드로이드 서버 (권장)
*안드로이드 폰 하나로 Vercel을 완전히 대체하여 프론트엔드(웹)와 백엔드(텔레그램 봇, 크롤러)를 모두 구동하는 풀스택 방식*

```mermaid
graph TD
    User[사용자 (텔레그램/브라우저)]
    CF[Cloudflare Tunnel <br>안전한 도메인 노출]
    Phone[안드로이드 공기계 <br>(Wi-Fi / 가정망)]
    DB[(외부 DB - Supabase)]
    Naver[네이버 부동산 API]

    User -->|URL / Webhook| CF
    CF -->|로컬 트래픽 라우팅| Phone
    Phone -->|데이터 저장/조회| DB
    Phone -->|매물 검색 요청 (IP 무사과)| Naver
    Naver -->|정상 데이터 반환!| Phone
    Phone -->|메시지/웹 화면| User
```

### 1-1. 시스템 구성 로직
1. **서버 런타임 (Termux)**: 안드로이드 기기에 리눅스 에뮬레이터 앱인 `Termux`를 설치하고 `Node.js` 환경을 구축합니다.
2. **코드 구동**: `Termux` 내부에서 현재 개발된 `real-estate-bot` Next.js 코드를 `npm run build && npm run start`로 24시간 백그라운드 구동합니다 (`localhost:3000`).
3. **포트 개방 (Cloudflare Tunnel)**: 안드로이드는 공유기(NAT) 뒤에 숨어있어 외부에서 접속할 수 없습니다. 무료 서비스인 [클라우드플레어 터널(cloudflared)](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/)을 폰에 설치해 `localhost:3000`을 `https://my-phone-bot.com` 같은 고정 도메인으로 전세계에 안전하게 노출합니다.
4. **텔레그램 연동**: 봇 Webhook URL을 새 도메인으로 설정하여 정상 영업을 시작합니다.

### 1-2 장단점 분석
| 장점 | 단점 |
|---|---|
| - Vercel 의존도 0% (호스팅 비용 평생 무료)<br>- 모바일/가정용 IP이므로 네이버 크롤링 영구 보장 | - 휴대폰을 항상 충전기에 꽂고 켜두어야 함<br>- (권장) 배터리 부풀음 방지 시스템 필요 |

---

## 🏗 아키텍처 옵션 2: 하이브리드 "안드로이드 프록시 에이전트"
*웹/텔레그램 서비스는 현행대로 Vercel에 남겨두고, 안드로이드 폰은 오직 '네이버 데이터를 긁어오는 대리인(Proxy Fetcher)' 역할만 수행하는 경량 방식*

```mermaid
graph TD
    User[사용자 (텔레그램/브라우저)]
    Vercel[Vercel 클라우드 서버]
    Target[안드로이드 프록시 폰 <br>(가정용 엣지 통로)]
    Naver[네이버 부동산 API]
    
    User --> Vercel
    Vercel -->|IP 우회를 위해 폰으로 요청| Target
    Target -->|집 IP로 정상 접속| Naver
    Naver -->|데이터 응답| Target
    Target -->|데이터 릴레이| Vercel
```

### 2-1. 시스템 구성 로직
1. **경량 서버 구축**: 안드로이드 폰(Termux)에는 `Next.js`라는 무거운 프레임워크 대신, 아주 가벼운 `Express.js` 서버만 띄워둡니다.
2. **전용 API 주소 맵핑**: 이 미니 서버는 Vercel에서 오는 요청을 받아 그대로 네이버에 전달하고, 네이버의 응답을 Vercel에 돌려주는 전용 '통과역' 역할을 합니다. 마찬가지로 Cloudflare Tunnel로 `https://my-proxy.com` 형태의 주소를 발급받습니다.
3. **Vercel 연동**: 현재 작성된 백엔드 코드(`actions.ts`)에서 네이버 API 주소를 폰의 터널 주소로 교체합니다.

### 2-2 장단점 분석
| 장점 | 단점 |
|---|---|
| - 폰이 꺼져도 봇 자체는 Vercel에서 죽지 않고 에러 처리가 가능<br>- 무거운 웹 렌더링을 Vercel이 담당해 폰에 과부하 없음 | - 결국 2가지 인프라(Vercel + 폰) 모두 유지보수 필요<br>- 네트워크를 두 번 건너야 하므로 미세한 속도 지연 발생 |

---

## 🛠 실행을 위한 단계별 소요 점검
만약 안드로이드 폰을 활용해 **[옵션 1]** 또는 **[옵션 2]**로 시스템 재건을 결심하신다면, 아래 단계들만 순서에 따라 저와 조립해 나가면 됩니다.

1. 사용하지 않는 안드로이드 폰 준비 (안드로이드 8.0 이상 권장)
2. 구글 플레이가 아닌, **F-Droid(오픈소스 마켓)**를 통한 [Termux] 최신버전 다운로드/설치 가이드
3. 터미널 조작을 통한 `Node.js` 환경 세팅
4. `Cloudflared` 글로벌 터널 개동 및 도메인 바인딩
5. 텔레그램 봇 신규 경로 업데이트 및 최종 Live 테스트

이 설계 방향으로 인프라 이전 개발을 즉시 시작할까요? 가장 직관적이고 강력한 **옵션 1(올인원 폰 서버)**을 추천합니다.
